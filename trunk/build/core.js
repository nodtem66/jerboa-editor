var Jerboa=function(k){k.lib={};k.lib.env={ie:/MSIE/i.test(navigator.userAgent),ie6:/MSIE 6/i.test(navigator.userAgent),ie7:/MSIE 7/i.test(navigator.userAgent),ie8:/MSIE 8/i.test(navigator.userAgent),firefox:/Firefox/i.test(navigator.userAgent),opera:/Opera/i.test(navigator.userAgent),webkit:/Webkit/i.test(navigator.userAgent),camino:/Camino/i.test(navigator.userAgent)};k.lib.onDomReady=function(f){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,false);else document.body&&
document.body.lastChild?f():setTimeout(function(){k.lib.onDomReady(f)},50)};k.lib.addEvent=function(f,h,l){h=h.toLowerCase();if(f.addEventListener)f.addEventListener(h,l,false);else f.attachEvent&&f.attachEvent("on"+h,l)};k.lib.removeEvent=function(f,h,l){h=h.toLowerCase();if(f.removeEventListener)f.removeEventListener(h,l,false);else f.detachEvent&&f.detachEvent("on"+h,l)};k.lib.getEvent=function(f){if(f.stopPropagation)f.stopPropagation();else f.cancelBubble=true;return{target:this.getTargetFromEvent(f),
preventDefault:function(){if(f.preventDefault)f.preventDefault();else f.returnValue=false}}};k.lib.getTargetFromEvent=function(f){f=f.srcElement||f.target;if(f.nodeType==3)f=f.parentNode;return f};k.lib.getArrayOfClassNames=function(f){var h=[];if(f.className)h=f.className.split(" ");return h};k.lib.addClass=function(f,h){var l=this.getArrayOfClassNames(f);l.push(h);f.className=l.join(" ")};k.lib.removeClass=function(f,h){for(var l=this.getArrayOfClassNames(f),o=[],p=0;p<l.length;p++)h!=l[p]&&o.push(l[p]);
f.className=o.join(" ")};k.lib.hasClass=function(f,h){var l;return f.className&&RegExp(h).test(f.className)};k.lib.getObjectOfStyle=function(f){f=f.getAttribute("style")||"";var h=0,l=0,o={},p="";if(f){f=f.split(";");h=0;for(l=f.length;h<l;h++)if(f[h]){p=f[h].split(":");if(p.length==2){p[0]=p[0].replace(/^[\s]+/g,"");p[1]=p[1].replace(/^[\s]+/g,"");p[0]=p[0].replace(/[\s]+$/g,"");p[1]=p[1].replace(/[\s]+$/g,"");o[p[0]]=p[1]}}}return o};k.lib.setObjectOfStyle=function(f,h){var l="",o;for(o in h)if(o.substr(0,
1)!="_")l=l.concat(o+":"+h[o]+";");f.setAttribute("style",l)};k.lib.addStyle=function(f,h){var l=this.getObjectOfStyle(f),o;for(o in h)if(o.substr(0,1)!="_")l[o]=h[o];this.setObjectOfStyle(f,l)};k.lib.removeStyle=function(f,h){var l=this.getObjectOfStyle(f),o,p;o=0;for(p=h.length;o<p;o++)l[h[o]]&&delete l[h[o]];this.setObjectOfStyle(f,l)};k.lib.setNode=function(f,h){if(arguments.length===0)return document.createElement("div");if(arguments.length==1){h=arguments[0];f=document.createElement(h.tag||
h.Tag||"div")}var l=h.Attr||h.attr||{},o=h.event||h.Event||{};if(o.add)this.addEvent(f,o.add,o.fn);else o.remove&&this.removeEvent(f,o.remove,o.fn);for(var p in l)p.substr(0,1)!="_"&&f.setAttribute(p,l[p]);if(h.html)f.innerHTML=h.html;return f};k.lib.request=function(f){var h=null,l=f.method?f.method.toUpperCase():"GET",o=f.url,p="",A="";delete f.method;delete f.url;h=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");for(p in f)if(p.substr(0.1)!="_")A+=p+"="+f[p]+"&";
A=A.substr(0,A.length-1);if(l=="GET")o=/\?/.test(o)?o+"&"+A:o+"?"+A;h.open(l,encodeURI(o),true);h.onreadystatechange=function(){if(h.readyState==4)h.status==200?alert("send"):alert("fail")};if(l=="POST"){h.setRequestHeader("Content-type","application/x-www-form-urlencoded");h.setRequestHeader("Content-length",A.split("&").length);h.setRequestHeader("Connection","close");h.send(encodeURI(A))}else h.send()};k.lib.detectMedia=function(f){var h={object:1,embed:1,video:1};if(typeof f==="object")return f.nodeName.toLowerCase()==
"div"&&f.getAttribute("role")?f.getAttribute("role"):f.nodeName.toLowerCase()=="img"?"image":h[f.nodeName.toLowerCase()]||f.getAttribute("class")=="jb-media-touch"?"media":f.nodeName.toLowerCase()=="iframe"?"iframe":"text";else if(typeof f==="string"){if(/^<img/i.test(f))return"image";else if(/^<iframe/.test(f))return"iframe";else for(var l in h)if(RegExp("^<"+l).test(f))return"media";return"text"}};k.lib.curry=function(f,h,l){var o=h||window,p=Array.prototype.slice.call(arguments,3);return l?function(){var A=
arguments;clearTimeout(f.tId);f.tId=setTimeout(function(){f.apply(o,p.concat(Array.prototype.slice.call(A,0)))},l)}:function(){f.apply(h,p.concat(Array.prototype.slice.call(arguments,0)))}};return k}(Jerboa||{});
Jerboa=function(k){function f(b){if(arguments.length<2)throw Error("hasImplement Error: Please use hasImplement(Object, Interface1 [, Interface2, ...])");for(var a=1,c=arguments.length,d,g;a<c;a++){var n=arguments[a];d=0;for(g=n.methods.length;d<g;d++){var t=n.methods[d];if(!b[t])throw Error("hasImplement Error: object did not implement "+n.name+" interface. Method "+t+" was not found.");}}}var h=function(b,a){this.name=b;this.methods=[];for(var c=0,d=a.length;c<d;c++){if(typeof a[c]!=="string")throw Error("Interface Error: Method names should be string.");
this.methods.push(a[c])}},l=function(b){var a,c={};b=b.toLowerCase();if(M[b])throw Error("Module "+b+" have been used");a=e.setNode({attr:{id:"jb-"+b.toLowerCase(),"class":"jb-panel jb-ignore hide"}});M[b.toLowerCase()]=true;this.getElement=function(){return a};this.add=function(d){a.appendChild(d.getElement());c[d.name]=d;return a.children.length-1};this.remove=function(d){a.removeChild(this.getChild(d))};this.getChild=function(d){if(d)return c[d]};this.show=function(){e.hasClass(a,"hide")&&e.removeClass(a,
"hide")};this.hide=function(){e.hasClass(a,"hide")||e.addClass(a,"hide")}},o=function(b){var a="",c=null,d=[],g,n=H.height||b.offsetHeight,t=H.width||b.offsetWidth;if(b.nodeName.toLowerCase()=="textarea"){a=b.value.replace(/&lt;/ig,"<").replace(/&gt;/ig,">");c=e.setNode({attr:{id:"jb-stage"},html:a})}else{c=b;J="native"}if(c.children[0]&&c.children[0].className=="jb-ignore"){g=c.children[0];b=g.innerHTML}else{g=e.setNode({tag:"div",attr:{"class":"jb-ignore",style:"position:relative;top:0;left:0;padding:0;width:"+
t+"px;height:"+n+"px;overflow:hidden;"}});b=c.innerHTML;c.innerHTML="";c.appendChild(g)}if(g.children[0]&&e.hasClass(g.children[0],"jb-layer"))d.push(g.children[0]);else{d.push(e.setNode({attr:{index:0,"class":"jb-layer jb-ignore",style:"position:absolute;top:0;left:0;width:100%;height:100%;z-index:2000;"},html:b}));g.appendChild(d[0])}this.currentState=this.currentEditingNode="";this.getElement=function(){return c};this.getLayer=function(){return d[0]};this.setHeight=function(u){e.addStyle(g,{height:u+
"px"})};this.autoHeight=function(){var u=0,D;D=0;for(N=d[0].children.length;D<N;D++)u+=d[0].children[D].offsetHeight;u=u>300?u:300;this.setHeight(u);J=="editor"&&s.option.setValue([u,0,0])};this.normalizeTree=function(u){if(!u)return"";var D=[],O=[],m,w,Q,E,q,K=true,z,j,r=u.cloneNode(true);D.push(r);for(O.push(u);D.length>0;){q=D.pop();currentNode2=O.pop();if(q.childNodes.length!==0){w=m=0;Q=currentNode2.childNodes.length;for(E=q.childNodes.length;m<E&&w<Q;m++,w++)if(q.childNodes[m].nodeName!="#text"&&
q.childNodes[m].nodeName!="#comment")if(!q.childNodes[m].getAttribute("role"))switch(e.detectMedia(q.childNodes[m])){case "image":if(!K&&q.childNodes.length==1){for(j=q;j.parentNode.childNodes.length==1&&!e.hasClass(j.parentNode,"jb-ignore");)j=j.parentNode;z=q.childNodes[m].cloneNode(true);z=e.setNode({tag:"div",attr:{role:"image",style:"position:absolute;top:"+currentNode2.childNodes[w].offsetTop+"px;left:"+currentNode2.childNodes[w].offsetLeft+"px;overflow:hidden;"}}).appendChild(z).parentNode;
r.appendChild(z);j.parentNode.removeChild(j)}else{j=q.childNodes[m].cloneNode(true);j=e.setNode({tag:"div",attr:{role:"image",style:"position:absolute;top:"+currentNode2.childNodes[w].offsetTop+"px;left:"+currentNode2.childNodes[w].offsetLeft+"px;overflow:hidden;"}}).appendChild(j).parentNode;r.appendChild(j);q.removeChild(q.childNodes[m]);m--;E--}break;case "iframe":if(!K&&q.childNodes.length==1){for(j=q;j.parentNode.childNodes.length==1&&!j.parentNode.getAttribute("index");)j=j.parentNode;z=q.childNodes[m].cloneNode(true);
z=e.setNode({tag:"div",attr:{role:"iframe",style:"position:absolute;top:"+currentNode2.childNodes[w].offsetTop+"px;left:"+currentNode2.childNodes[w].offsetLeft+"px;overflow:hidden;"},html:'<div class="jb-media-touch">&#160;</div>'}).appendChild(z).parentNode;r.appendChild(z);j.parentNode.removeChild(j)}else{j=q.childNodes[m].cloneNode(true);j=e.setNode({tag:"div",attr:{role:"iframe",style:"position:absolute;top:"+currentNode2.childNodes[w].offsetTop+"px;left:"+currentNode2.childNodes[w].offsetLeft+
"px;overflow:hidden;"},html:'<div class="jb-media-touch">&#160;</div>'}).appendChild(j).parentNode;r.appendChild(j);q.removeChild(q.childNodes[m]);m--;E--}break;case "media":if(!K&&q.childNodes.length==1){for(j=q;j.parentNode.childNodes.length==1&&!j.parentNode.getAttribute("index");)j=j.parentNode;z=q.childNodes[m].cloneNode(true);z=e.setNode({tag:"div",attr:{role:"media",style:"position:absolute;top:"+currentNode2.childNodes[w].offsetTop+"px;left:"+currentNode2.childNodes[w].offsetLeft+"px;overflow:hidden;"},
html:'<div class="jb-media-touch">&#160;</div>'}).appendChild(z).parentNode;r.appendChild(z);j.parentNode.removeChild(j);if(z.childNodes[1].nodeName.toLowerCase()=="object"){z.childNodes[1].insertBefore(e.setNode({tag:"param",attr:{name:"wmode",value:"opaque"}}),j.childNodes[1].childNodes[0]);z.childNodes[1].lastChild.setAttribute("wmode","opaque")}}else{j=q.childNodes[m].cloneNode(true);j=e.setNode({tag:"div",attr:{role:"media",style:"position:absolute;top:"+currentNode2.childNodes[w].offsetTop+
"px;left:"+currentNode2.childNodes[w].offsetLeft+"px;overflow:hidden;"},html:'<div class="jb-media-touch">&#160;</div>'}).appendChild(j).parentNode;if(j.childNodes[1].nodeName.toLowerCase()=="object"){j.childNodes[1].insertBefore(e.setNode({tag:"param",attr:{name:"wmode",value:"opaque"}}),j.childNodes[1].childNodes[0]);j.childNodes[1].lastChild.setAttribute("wmode","opaque")}r.appendChild(j);q.removeChild(q.childNodes[m]);m--;E--}break;case "text":if(q.childNodes[m].innerHTML===""&&q.childNodes[m].nodeName.toLowerCase()!=
"div"){q.removeChild(q.childNodes[m]);m--;E--;continue}else if(K)if(q.childNodes[m].nodeName.toLowerCase()!="div"){j=q.childNodes[m].cloneNode(true);j=e.setNode().appendChild(j).parentNode;j=e.setNode({tag:"div",attr:{role:"text",style:"position:absolute;top:"+currentNode2.childNodes[w].offsetTop+"px;left:"+currentNode2.childNodes[w].offsetLeft+"px;overflow:hidden;"}}).appendChild(j).parentNode;if(r.childNodes.length===0)r.appendChild(j);else{r.insertBefore(j,r.childNodes[m]);r.removeChild(r.childNodes[m+
1])}}else e.setNode(r.childNodes[m],{attr:{role:"text",style:"position:absolute;top:"+currentNode2.childNodes[w].offsetTop+"px;left:"+currentNode2.childNodes[w].offsetLeft+"px;overflow:hidden;"}});D.push(q.childNodes[m]);O.push(currentNode2.childNodes[w])}if(K)K=false}}m=0;for(E=r.childNodes.length;m<E;m++)if(r.childNodes[m].nodeName=="#text"){if(/[\S]/ig.test(r.childNodes[m].nodeValue)){j=e.setNode({tag:"div",attr:{role:"text",style:"position:absolute;top:"+r.childNodes[m].offsetTop+"px;left:"+r.childNodes[m].offsetLeft+
"px;"},html:"<div>"+r.childNodes[m].nodeValue+"</div>"});r.removeChild(r.childNodes[m]);r.appendChild(j)}else{r.removeChild(r.childNodes[m]);E--}m--}else e.addStyle(r.childNodes[m],{position:"absolute",overflow:"hidden",padding:0,margin:0,display:"inline-block"});u.innerHTML=r.innerHTML;return true};var B=this;setTimeout(function(){B.autoHeight();B.normalizeTree(d[0]);F.save(d[0].innerHTML)},100)},p=function(b){if(!b)throw Error("name of Box missing");b=b.toLowerCase();var a=e.setNode({attr:{id:"jb-"+
b,"class":"jb-ignore hide"}}),c=[];this.name=b;this.getElement=function(){return a};this.getValue=function(){for(var d=[],g=0,n=c.length;g<n;g++)d.push(c[g].getValue());return d};this.setValue=function(d){if(d.length==c.length)for(var g=0,n=d.length;g<n;g++)c[g].setValue(d[g])};this.add=function(d){c.push(d);a.appendChild(d.getElement());return c[c.length-1]};this.remove=function(d){if(c[d]){a.removeChild(c[d]);delete c[d]}}},A=function(b,a,c){var d=e.setNode({attr:{"class":"jb-button jb-ignore "+
(c?c:"")},html:b,event:{add:"click",fn:function(g){y.notify("click-button-"+a,g)}}});this.name=a;this.getValue=function(){return b};this.setValue=function(g){e.setNode(d,{html:g})};this.getElement=function(){return d}},W=function(b){var a=e.setNode({attr:{"class":"jb-flipswitch jb-ignore"}}),c=e.setNode({attr:{"class":"jb-button jerboa-ignore"}}),d=e.setNode({attr:{"class":"hide"},html:"on"}),g=e.setNode({html:"off"}),n=e.setNode({tag:"label",attr:{"class":"jb-ignore"},html:b}),t=false;a.appendChild(n);
a.appendChild(c);c.appendChild(d);c.appendChild(g);this.name=b;this.toggle=function(B){B&&e.getEvent(B).preventDefault();if(t){t=false;e.removeClass(g,"hide");e.addClass(d,"hide")}else{t=true;e.removeClass(d,"hide");e.addClass(g,"hide")}y.notify("click-flipswitch-"+b,t)};this.getElement=function(){return a};this.getValue=function(){return t};this.setValue=function(B){t!=B&&this.toggle()};e.setNode(c,{event:{add:"mousedown",fn:e.curry(this.toggle,this)}})},X=function(b){var a=e.setNode({attr:{"class":"hline "+
(b?b:"")}});this.name="jb-hline"+Date();this.getElement=function(){return a};this.getValue=function(){return""};this.setValue=function(){}},Y=function(b,a,c){var d=e.setNode(),g=e.setNode({tag:"input",attr:{value:a?a:"",type:"text","class":c?c:""}});a=e.setNode({tag:"label",html:b});d.appendChild(a);d.appendChild(g);this.name=b;this.setClass=function(n){e.setNode(g,{attr:{"class":n}})};this.getValue=function(){return g.value};this.setValue=function(n){g.value=n};this.getElement=function(){return d}},
Z=function(b,a,c){var d=e.setNode(),g=e.setNode({tag:"textarea",attr:{"class":c?c:""},html:a?a:""});a=e.setNode({tag:"label",html:b});d.appendChild(a);d.appendChild(g);this.name=b;this.setClass=function(n){e.setNode(g,{attr:{"class":n}})};this.getValue=function(){return g.innerHTML};this.setValue=function(n){g.innerHTML=n};this.getElement=function(){return d}},$=function(b,a,c,d,g){b=b||"selectbox";var n=e.setNode({attr:{"class":"jb-selectbox"+(g&&" "+g||""),style:c},html:"<span>"+b+"</span>"}),t=
e.setNode({attr:{"class":"hide",style:d}}),B=this;if(a){c=0;for(d=a.length;c<d;c++)t.appendChild(e.setNode({tag:"span",html:a[c]}));n.appendChild(t)}this.name=b;this.getElement=function(){return n};this.toggle=function(){e.hasClass(t,"hide")?e.removeClass(t,"hide"):e.addClass(t,"hide")};this.getValue=function(){return _value};this.setValue=function(u){_value=u;y.notify("change-selectbox-"+b,u)};e.setNode(n,{event:{add:"mousedown",fn:function(u){u=e.getEvent(u);u.preventDefault();B.toggle();u.target.innerHTML!=
b&&B.setValue(u.target.innerHTML)}}})},P=function(b){if(!b)throw Error("Using UI({....})");var a=b.type.toLowerCase()||"button",c=(new Date).getTime(),d=b["class"]||b.align;switch(a){case "button":return new A(b.label||"button",b.name||"button"+c,d);case "flipswitch":return new W(b.label||"FlipSwitch",d);case "textfield":return new Y(b.label||"TextField",b.text||b.value,d);case "textarea":return new Z(b.label||"TextArea",b.text||b.value,d);case "hline":return new X(d);case "selectbox":return new $(b.label,
b.text||b.value,b.styleMain,b.styleDropdown,d);default:throw Error('check "type" in UI({....})');}},aa=new h("Library",["onDomReady","addEvent","removeEvent","getEvent","addClass","removeClass","hasClass","addStyle","removeStyle","setNode","curry","request"]),ba=new h("Module",["init","destroy"]),ca=new h("Box",["add","remove","getValue","setValue","getElement","name"]);new h("UI",["getValue","setValue","name"]);f(k.lib,aa);var e=k.lib;delete k.lib;var R=k.path;delete k.path;var M={},s={},H={},I=
{},i=null,C=null,x={},L=new function(){var b=e.setNode({attr:{id:"jb-box","class":"jb-ignore hide"}}),a={},c="";this.getElement=function(){return b};this.add=function(d){f(d,ca);a[d.name]=d;b.appendChild(d.getElement())};this.remove=function(d){if(a[d]){b.removeChild(a[d]);delete a[d]}};this.getBox=function(d){if(a[d])return a[d]};this.show=function(d){c=d;e.removeClass(b,"hide");e.removeClass(a[d].getElement(),"hide");d=Math.min(document.body.clientHeight,document.documentElement.clientHeight);var g=
Math.min(document.body.clientWidth,document.documentElement.clientWidth);d=d-b.offsetHeight>0?(d-b.offsetHeight)/2:0;g=g-b.offsetWidth>0?(g-b.offsetWidth)/2:0;e.setNode(b,{attr:{style:"top:"+d+"px;left:"+g+"px;"}})};this.hide=function(){e.addClass(b,"hide");e.addClass(a[c].getElement(),"hide")}},F=new function(b,a){var c=[],d=-1,g=0,n=0,t=true;size=b||10;this.save=function(B){if(!t)return false;n!=size&&n++;d=(d+1)%size;g=1;c[d]=B};this.undo=function(){if(!t)return false;if(n-1>0){d=d-1>=0?d-1:size-
1;n--;g++;a(c[d])}};this.redo=function(){if(!t)return false;if(g-1>0){d=(d+1)%size;n++;g--;a(c[d])}};this.clear=function(){c=[];n=g=0;d=-1};this.freeze=function(){t=false};this.unfreeze=function(){t=true}}(10,function(b){i.getLayer().innerHTML=b}),y=new function(){var b={};this.lib=e;this.Class=function(a){if(!{Panel:1,Button:1,FlipSwitch:1,Hline:1,TextField:1,TextArea:1,History:1,Input:1}[a])throw Error("sandbox: not found "+a+" in Class");return eval(a)};this.getPath=function(){return R};this.getHistory=
function(){return F};this.getStage=function(){return i};this.getUI=function(a){if(!s[a])throw Error("sandbox: not found "+a+" in UI");return s[a]};this.addPanel=function(a){a=new l(a);s.panelbar.appendChild(a.getElement());return a};this.notify=function(a,c){var d=a.split("-"),g,n;d={event:d[0]||"",subevent:d[1]||"",name:d[2]||"",data:c};if(b[a]){g=0;for(n=b[a].length;g<n;g++)b[a][g](d)}if(b[d.event+"-"+d.ui]){g=0;for(n=b[d.event+"-"+d.ui].length;g<n;g++)b[d.event+"-"+d.ui][g](d)}if(b[d.event]){g=
0;for(n=b[d.event].length;g<n;g++)b[d.event][g](d)}};this.listen=function(a,c,d){if(typeof a==="string"){b[a]||(b[a]=[]);b[a].push(e.curry(c,d))}for(var g=0,n=a.length;g<n;g++){b[a[g]]||(b[a[g]]=[]);b[a[g]].push(e.curry(c,d))}};this.hasModule=function(a){if(I[a])return true;return false};this.insertHTML=function(a){if(/^<div role/i.test(a))a=e.setNode({html:a}).children[0];else{typeMedia=e.detectMedia(a);if(typeMedia=="media"||typeMedia=="iframe")a='<div class="jb-media-touch"> </div>'+a;a=e.setNode({html:a,
attr:{role:typeMedia,style:"position:absolute;top:0px;left:0px;overflow:hidden;"}})}i.getLayer().appendChild(a)}},J="editor";k.version=0.001;k.register=function(b,a){var c=new a(y);f(c,ba);b=b.toLowerCase();if(I[b])throw Error("Duplicate Module: "+b);I[b]=c;s.core&&I[b].init(H[b])};h=0;for(var N=k.tempRegister.length;h<N;h++)k.register.apply(null,k.tempRegister[h]);delete k.tempRegister;k.apply=function(b,a){var c;if(!(c=document.getElementById(b)))return false;C=c;if(a)H=a;da()};k.dismiss=function(){v();
s.core.parentNode.removeChild(s.core);J=="editor"&&e.removeEvent(document,"submit",S);document.body.removeChild(L.getElement());if(J=="editor")C.value=k.getContent();else C.innerHTML=k.getContent();e.removeClass(C,"hide");e.removeEvent(document,"click",T);e.removeEvent(document,"dblclick",U);e.removeEvent(document,"keydown",V);F.clear();J="editor";M={};s={};H={};I={};C=i=null;x={}};k.getContent=function(){var b="";return b=i.getElement().innerHTML};var G=function(b){var a=x,c=e.getEvent(b);i.currentState!=
"textedit"&&c.preventDefault();if(b.type=="mousedown"){if(i.currentState!="textedit"||b.shiftKey){c.preventDefault();a.x=b.pageX;a.y=b.pageY;a.isMove=false;e.addEvent(document,"mousemove",G);e.addEvent(document,"mouseup",G)}}else if(b.type=="mousemove"){a.isMove=true;if(b.shiftKey){a.root_w+=b.pageX-a.x;a.root_h+=b.pageY-a.y}else if(/move$/i.test(i.currentState)){a.root_left+=b.pageX-a.x;a.root_top+=b.pageY-a.y}if(a.root_top+a.root_h+2>a.screen_h)if(b.shiftKey)a.root_h=a.screen_h-a.root_top-2;else a.root_top-=
b.pageY-a.y;else if(a.root_top<0)a.root_top-=b.pageY-a.y;if(a.root_left+a.root_w+2>a.screen_w)if(b.shiftKey)a.root_w=a.screen_w-a.root_left-2;else a.root_left-=b.pageX-a.x;else if(a.root_left<0)a.root_left-=b.pageX-a.x;if(b.shiftKey){e.addStyle(i.currentEditingNode,{width:a.root_w+"px",height:a.root_h+"px"});if(/^image/i.test(i.currentState))e.addStyle(i.currentEditingNode.children[0],{width:a.root_w+"px",height:a.root_h+"px"});else if(/^media/i.test(i.currentState)&&i.currentEditingNode.children.length>=
2){e.addStyle(i.currentEditingNode.children[1],{width:a.root_w+"px",height:a.root_h+"px"});e.setNode(i.currentEditingNode.children[1],{attr:{width:a.root_w,height:a.root_h}});e.addStyle(i.currentEditingNode.getElementsByTagName("embed")[0],{width:a.root_w+"px",height:a.root_h+"px"})}else if(/^iframe/i.test(i.currentState)){e.setNode(i.currentEditingNode.children[1],{attr:{width:a.root_w,height:a.root_h}});e.addStyle(i.currentEditingNode.children[1],{width:a.root_w+"px",height:a.root_h+"px"})}}else/move$/i.test(i.currentState)&&
e.addStyle(i.currentEditingNode,{top:a.root_top+"px",left:a.root_left+"px"});a.x=b.pageX;a.y=b.pageY}else if(b.type=="mouseup"){a.isMove&&F.save(i.getLayer().innerHTML);e.removeEvent(document,"mousemove",G);e.removeEvent(document,"mouseup",G)}},v=function(){if(!i.currentState){for(var b=i.getLayer().children,a=0,c=b.length;a<c;a++)e.hasClass(b[a],"jb-touch")&&e.removeClass(b[a],"jb-touch");return false}e.removeClass(i.currentEditingNode,"jb-touch");e.removeEvent(i.currentEditingNode,"mousedown",G);
switch(i.currentState){case "textedit":b=i.currentEditingNode.children[0];b.setAttribute("contenteditable","false");b.blur();window.getSelection().removeAllRanges();F.save(i.getLayer().innerHTML)}i.currentEditingNode=null;i.currentState="";y.notify("restorestate")},T=function(b){b=e.getEvent(b);var a="";a=false;if(b.target.nodeName.toLowerCase()=="html"){v();return false}i.currentState=="textedit"&&e.hasClass(b.target,"jb-ignore")&&v();if(!e.hasClass(b.target,"jb-ignore")){var c=b.target;if(c.parentNode)for(;!(c.parentNode.getAttribute("class")&&
e.hasClass(c.parentNode,"jb-ignore"));){if(c.parentNode.nodeName&&c.parentNode.getAttribute("id")=="jb-a"){v();b.preventDefault();return false}if(!c.parentNode.nodeName||c.parentNode.nodeName.toLowerCase()=="html"||c.parentNode.nodeName.toLowerCase()=="body"){v();a=true;break}c=c.parentNode;if(!c.parentNode){v();a=true;break}}else a=true;a||b.preventDefault();if(!c.parentNode.getAttribute("index"))return false;if(i.currentEditingNode==c)return false;if(!a){i.currentEditingNode!==null&&v();a=e.detectMedia(c);
i.currentEditingNode=c;e.addClass(c,"jb-touch");e.addEvent(c,"mousedown",G);i.currentState=a+"move";y.notify(a+"move");tempStage=i.getElement();x.isMove=false;x.screen_top=tempStage.offsetTop;x.screen_left=tempStage.offsetLeft;x.screen_w=tempStage.offsetWidth;x.screen_h=tempStage.offsetHeight;x.root_top=c.offsetTop;x.root_left=c.offsetLeft;x.root_w=c.offsetWidth;x.root_h=c.offsetHeight;return false}}v()},U=function(b){b=e.getEvent(b);var a=false;if(b.target.nodeName.toLowerCase()=="html"){v();return false}if(!e.hasClass(b.target,
"jb-ignore")){var c=b.target;if(c.parentNode)for(;!(c.parentNode.getAttribute("class")&&e.hasClass(c.parentNode,"jb-ignore"));){if(c.parentNode.nodeName&&c.parentNode.getAttribute("id")=="jb-a"){v();b.preventDefault();return false}if(!c.parentNode.nodeName||c.parentNode.nodeName.toLowerCase()=="html"||c.parentNode.nodeName.toLowerCase()=="body"){v();a=true;break}c=c.parentNode;if(!c.parentNode){v();a=true;break}}else a=true;a||b.preventDefault();if(!c.parentNode.getAttribute("index"))return false;
if(!a){switch(e.detectMedia(c)){case "text":if(i.currentEditingNode==c&&i.currentState=="textedit")break;i.currentEditingNode!==null&&v();i.currentEditingNode=c;e.addClass(c,"jb-touch");e.addEvent(c,"mousedown",G);if(c.childNodes.length!=1)c.innerHTML="<div>"+c.innerHTML+"</div>";c.childNodes[0].setAttribute("contenteditable","true");c.childNodes[0].focus();i.currentState="textedit";y.notify("textedit")}return false}}},V=function(b){var a=e.getEvent(b),c;if(a.target.nodeName.toLowerCase()=="input")return false;
if(b.keyCode==27)v();else if(b.metaKey||b.ctrlKey)if(b.keyCode==90){y.notify("keydown-normal-undo");v()}else if(b.keyCode==89){y.notify("keydown-normal-redo");v()}else if(b.keyCode==86&&!/edit$/i.test(i.currentState)){y.notify("keydown-noediting-paste",b);v()}if(/move$/i.test(i.currentState))if(b.metaKey||b.ctrlKey)if(b.keyCode==67){y.notify("keydown-move-copy");v()}else{if(b.keyCode==88){y.notify("keydown-move-copy");i.getLayer().removeChild(i.currentEditingNode);v()}}else if(b.keyCode==8||b.keyCode==
46){i.getLayer().removeChild(i.currentEditingNode);F.save(i.getLayer().innerHTML);v()}else if(b.keyCode==9){b=i.currentEditingNode.nextSibling?i.currentEditingNode.nextSibling:i.getLayer().firstChild;v();mediaType=e.detectMedia(b);i.currentEditingNode=b;e.addClass(b,"jb-touch");e.addEvent(b,"mousedown",G);i.currentState=mediaType+"move";y.notify(mediaType+"move");c=i.getElement();x.isMove=false;x.screen_top=c.offsetTop;x.screen_left=c.offsetLeft;x.screen_w=c.offsetWidth;x.screen_h=c.offsetHeight;
x.root_top=b.offsetTop;x.root_left=b.offsetLeft;x.root_w=b.offsetWidth;x.root_h=b.offsetHeight;a.preventDefault()}},S=function(){C.value=k.getContent()},da=function(){var b=document.createDocumentFragment(),a;a=H.width||C.offsetWidth-2;i=new o(C);if(J=="native")a=null;else{s.core=e.setNode({attr:{id:"jb-a",style:"width:"+a+"px;"},event:{add:"mousedown",fn:function(d){e.getEvent(d).preventDefault();return false}}});s.panelbar=e.setNode({attr:{id:"jb-b"}});s.bottom=e.setNode({attr:{"class":"jb-hline"},
event:{add:"click",fn:function(){L.show("option")}}});s.core.appendChild(s.panelbar);s.core.appendChild(i.getElement());s.core.appendChild(s.bottom);s.option=new p("option");s.option.add(new P({type:"TextField",label:"Height <span>input the height which you want</span>",align:"last bigger"}));s.option.add(new P({type:"hline"}));s.option.add(new P({type:"button",label:"Set Height",name:"option",align:"right bottom"}));L.add(s.option);s.mainmenu=y.addPanel("mainmenu");a=s.mainmenu.getElement();a.appendChild(e.setNode().appendChild(e.setNode({tag:"button",
html:'<span style="background: url('+R+'/img/inserttextbox.png) no-repeat">Insert TextBox</span>',event:{add:"click",fn:function(){v();i.getLayer().appendChild(e.setNode({attr:{role:"text",style:"position:absolute;top:0;left:0;"},html:"<div>Insert Text Here</div>"}));F.save(i.getLayer().innerHTML)}}})).parentNode);s.mainmenu.show();for(var c in I)c.substr(0,1)!="_"&&I[c].init(H[c]);y.listen("click-button-option",function(){var d=s.option.getValue()[0];isNaN(d)||i.setHeight(d);L.hide()});e.addEvent(document,
"submit",S);e.addClass(C,"hide");b.appendChild(s.core);C.parentNode.insertBefore(b,C);document.body.appendChild(L.getElement())}y.listen("keydown-normal-undo",function(){F.undo()});y.listen("keydown-normal-redo",function(){F.redo()});e.addEvent(document,"click",T);e.addEvent(document,"dblclick",U);e.addEvent(document,"keydown",V)};k.tempApply&&k.apply(k.tempApply[0],k.tempApply[1]);delete k.tempApply;return k}(Jerboa||{});
