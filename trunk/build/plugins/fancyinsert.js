Jerboa.register("FancyInsert",function(a){var d=a.lib;var c=function(){var f=d.setNode({attr:{contenteditable:"true",style:"position:absolute;top:0;display:inline-block;overflow:hidden;width:1px;height:1px;"}}),e="",g=null;this.getElement=function(){return f};this.getValue=function(){f.blur();if(!g){return f.innerHTML}if(f.innerHTML==e||e===""){var j=g.attributes,l="<div";for(var k=0,h=j.length;k<h;k++){l+=" "+j[k].name+'="'+j[k].value+'"'}l+=">"+g.innerHTML+"</div>";return l}g=null;return f.innerHTML};this.setValue=function(h){f.innerHTML=h};this.setJerboaData=function(h){g=h};this.focus=function(){e=f.innerHTML;f.innerHTML="";f.focus()}};var b=new c();this.sendDecorateNode=function(k){var i="",j,g,f={png:1,jpg:1,gif:1},h={pdf:1,ppt:1,pptx:1,tiff:1};if(k){i=k.replace(/<meta[^>]+>/i,"");if(/<span[^>]*Apple-style-span[^>]+>/i.test(i)){i=i.replace(/<span[^>]*Apple-style-span[^>]+>/i,"").replace(/<\/span>$/i,"")}if(/^<a href="([^>]+)">\1<\/a>$/i.test(i)){i=i.replace(/^<a href="([^>]+)">/i,"").replace(/<\/a>$/i,"")}if(/^http/i.test(i)){var e=i.split(".");e=e[e.length-1];if(f[e]){i='<img src="'+i+'" />'}if(h[e]){i='<iframe src="http://docs.google.com/viewer?url='+i+'&embedded=true" frameborder="0" width="400" height="100"></iframe>'}}if(/^\&lt;object/i.test(i)){i=i.replace(/&lt;/ig,"<").replace(/&gt;/ig,">");i=i.replace(/><param/i,'><param wmode="opaque"><param');i=i.replace(/<embed/i,'<embed wmode="opaque"');i=i.replace(/<\/embed>/i,"</embed><!-- kill -->");i=i.replace(/<!-- kill -->.*/ig,"")}if(/^\&lt;embed/i.test(i)){i=i.replace(/&lt;/ig,"<").replace(/&gt;/ig,">");i=i.replace(/<embed/i,'<embed wmode="opaque"');i=i.replace(/<\/embed>/i,"</embed><!-- kill -->");i=i.replace(/<!-- kill -->.*/ig,"")}if(/^\&lt;iframe[\D\S]*src=["']https:\/\/spreadsheets.google.com\//i.test(i)){i=i.replace(/&lt;/ig,"<").replace(/&gt;/ig,">")}else{if(/^\&lt;iframe[\D\S]*src=["']http:\/\/docs.google.com\/gview\?/i.test(i)){i=i.replace(/&lt;/ig,"<").replace(/&gt;/ig,">")}}}else{i="Insert Text here"}a.insertHTML(i)};this.init=function(){var e=this;a.getUI("core").appendChild(b.getElement());a.listen("keydown-noediting-paste",function(){b.focus();setTimeout(function(){e.sendDecorateNode(b.getValue());a.getHistory().save(a.getStage().getLayer().innerHTML)},100)},this);a.listen("keydown-move-copy",function(){b.setJerboaData(a.getStage().currentEditingNode)},this)};this.destroy=function(){a.getUI("core").removeChild(b.getElement())}});