Jerboa.register("TextMenu",function(b){var d=b.lib,a,c;this.enable=true;this.execute=function(i){var f={forecolor:true,backcolor:true},h={justifyleft:true,justifycenter:true,justifyright:true,justifyfull:true},g={clear:true,transparent:true,remove:true,clearcolor:true,removecolor:true},e=arguments[1]||null;if(i=="fontname"){document.execCommand("fontname",false,e);return false}if(h[i]){if(!document.execCommand(i,false,e)){d.addStyle(Jerboa.currentEditElement,{"text-align":i.replace(/justify/ig,"").replace(/full/ig,"justify")})}return false}if(f[i]){e=prompt("Insert RGB color","000000");if(g[e]||(e.length!=3&&e.length!=6)){e="transparent"}else{if(d.env.firefox||d.env.webkit){e="#"+e}}}document.execCommand(i,false,e)};this.init=function(e){var f=null,k,j,l,m,g,n=b.getPath(),h=false;a=b.addPanel("textmenu");c=a.getElement();if(e&&e.button){k=e.button.split(";")}else{k=["indent,outdent,insertunorderedlist,insertorderedlist","forecolor,backcolor,bold,italic,underline,justifyleft,justifycenter,justifyright,justifyfull","fontfamily"]}for(j=0,l=k.length;j<l;j++){k[j]=k[j].split(",");if(!k[j][0]){continue}f=d.setNode();for(m=0,g=k[j].length;m<g;m++){if(j>0&&m===0){h=true}if(k[j][m]=="fontfamily"){h=true;if(e&&e.font){if(m==g-1){f.appendChild((new b.Class("Input")({type:"selectbox",label:"fontfamily",value:e.font.split(","),styleMain:"margin:0;margin-left:2px;",styleDropdown:"margin:0;top:29px;left:-1px;"})).getElement())}else{if(m===0){f.appendChild((new b.Class("Input")({type:"selectbox",label:"fontfamily",value:e.font.split(","),styleMain:"margin:0;margin-left:2px;",styleDropdown:"margin:0;top:29px;left:-1px;"})).getElement());c.appendChild(f);f=d.setNode()}else{c.appendChild(f);f=d.setNode();f.appendChild((new b.Class("Input")({type:"selectbox",label:"fontfamily",value:e.font.split(","),styleMain:"margin:0;margin-left:2px;",styleDropdown:"margin:0;top:29px;left:-1px;"})).getElement());c.appendChild(f);f=d.setNode()}}}}else{if(h){f.appendChild(d.setNode({tag:"button",html:'<span style="background: url('+n+"/img/"+k[j][m]+'.png) -1px -1px no-repeat"></span>',event:{add:"click",fn:d.curry(this.execute,this,0,k[j][m])},attr:{style:"margin-left:2px"}}));h=false}else{if(k[j][m]=="bold"){f.appendChild(d.setNode({tag:"button",html:"<b>B</b>",event:{add:"click",fn:d.curry(this.execute,this,0,k[j][m])}}))}else{if(k[j][m]=="italic"){f.appendChild(d.setNode({tag:"button",html:"<i>I</i>",event:{add:"click",fn:d.curry(this.execute,this,0,k[j][m])}}))}else{if(k[j][m]=="underline"){f.appendChild(d.setNode({tag:"button",html:"<u>U</u>",event:{add:"click",fn:d.curry(this.execute,this,0,k[j][m])}}))}else{f.appendChild(d.setNode({tag:"button",html:'<span style="background: url('+n+"/img/"+k[j][m]+'.png) -1px -1px no-repeat"></span>',event:{add:"click",fn:d.curry(this.execute,this,0,k[j][m])}}))}}}}}}c.appendChild(f)}b.listen("textedit",function(){a.show();b.getUI("mainmenu").hide()},this);b.listen("restorestate",function(){a.hide();b.getUI("mainmenu").show()},this);b.listen("change-selectbox-fontfamily",function(i){this.execute("fontname",i.data)},this)};this.destroy=function(){}});